<!DOCTYPE html>
<html dir="ltr" lang="vi" class="no-js usn">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no, maximum-scale=2.0, user-scalable=yes, viewport-fit=cover" />
    <title>FE Credit - Xác nhận khoản vay - FE CREDIT - VAY TIÊU DÙNG TÍN CHẤP</title>
    
    <!-- External CSS Bundles from index.html -->
    <link href="https://www.fecredit.com.vn/sb/sitebuilder-ltr-css-bundle.css.ve71a07e0be8131442699d18627f92642a8170edc" media="screen" rel="stylesheet" />
    <link href="https://www.fecredit.com.vn/sb/sitebuilder-css-bundle.css.ve71a07e0be8131442699d18627f92642a8170edc" media="screen" rel="stylesheet" />
    <link href="https://www.fecredit.com.vn/sb/sitebuilder-css-small-header-01-sm-bundle.css.ve71a07e0be8131442699d18627f92642a8170edc" media="screen and (min-width:0) and (max-width:991px)" rel="stylesheet" />
    <link href="https://www.fecredit.com.vn/sb/sitebuilder-css-large-header-07-lg-bundle.css.ve71a07e0be8131442699d18627f92642a8170edc" media="screen and (min-width:992px)" rel="stylesheet" />
    <link href="https://www.fecredit.com.vn/sb/css-customs-bundle.css.ve71a07e0be8131442699d18627f92642a8170edc" media="screen" rel="stylesheet" />
    <link href="https://www.fecredit.com.vn/sb/css-footer-bundle.css.ve71a07e0be8131442699d18627f92642a8170edc" media="screen" rel="stylesheet" />
    
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/svg" href="https://www-cdn.fecredit.com.vn/media/yienoinl/favicon-feonl-01.svg?width=32&height=32">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <!-- Unified Design Tokens -->
    <link rel="stylesheet" href="../../configs/shared/fecredit-design-tokens.css" />
    <style>
      /* Design tokens are now imported from fecredit-design-tokens.css */
      /* Only page-specific overrides here if needed */

      /* Progress Stepper */
      .progress-stepper-wrapper {
        background: var(--white-color);
        box-shadow: var(--shadow-sm);
        position: sticky;
        top: 0;
        z-index: 100;
        padding: var(--spacing-md) var(--spacing-sm);
        margin-bottom: var(--spacing-lg);
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .progress-stepper {
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 600px;
        margin: 0 auto;
        max-width: 900px;
      }

      .stepper-step {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--spacing-xs);
        min-width: 60px;
      }

      .stepper-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--border-color);
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 0.875rem;
        transition: all 0.3s ease;
      }

      .stepper-step.completed .stepper-circle {
        background: var(--success-color);
        color: white;
      }

      .stepper-step.active .stepper-circle {
        background: var(--primary-color);
        color: white;
        box-shadow: 0 0 0 4px rgba(0, 153, 79, 0.2);
      }

      .stepper-label {
        font-size: 0.75rem;
        color: var(--text-secondary);
        font-weight: 500;
        white-space: nowrap;
        text-align: center;
      }

      .stepper-step.completed .stepper-label,
      .stepper-step.active .stepper-label {
        color: var(--text-primary);
        font-weight: 600;
      }

      .stepper-line {
        height: 2px;
        flex: 1;
        background: var(--border-color);
        min-width: 30px;
        transition: all 0.3s ease;
      }

      .stepper-line.completed {
        background: var(--success-color);
      }

      .stepper-line.active {
        background: linear-gradient(90deg, var(--primary-color) 0%, var(--border-color) 100%);
      }

      html, body {
        overflow-x: hidden !important;
        max-width: 100vw !important;
        width: 100% !important;
      }

      body {
        font-family: "Inter", "Be Vietnam Pro", sans-serif;
        background-color: var(--body-bg);
        color: var(--text-primary);
        width: 100% !important;
        max-width: 100% !important;
      }
      
      /* Site Structure */
      #site {
        display: flex;
        flex-direction: column;
        min-height: 100dvh;
      }

      /* Subheader */
      #site-subheader {
        background: var(--white-color);
        border-bottom: 1px solid var(--border-color);
        padding: 8px 0;
      }
      
      .sub-header-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 12px;
      }
      
      .sub-header-list {
        display: flex;
        list-style: none;
        gap: 24px;
        margin: 0;
        padding: 0;
      }
      
      .sub-header-list li a {
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 14px;
        transition: color 0.3s;
      }
      
      .sub-header-list li a:hover {
        color: var(--primary-color);
      }
      
      .site-search-form {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      
      .site-search-form input {
        padding: 6px 12px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        font-size: 14px;
      }
      
      .site-search-form button {
        padding: 6px 12px;
        background: var(--primary-color);
        color: var(--white-color);
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      /* FE Credit Header */
      #site-header {
        background: var(--white-color);
        border-bottom: 1px solid var(--border-color);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        position: sticky;
        top: 0;
        z-index: 1000;
        padding: 15px 0;
      }
      
      #site-header .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      #logo a {
        display: flex;
        align-items: center;
        text-decoration: none;
        gap: 10px;
      }
      
      #logo img {
        height: 40px;
        max-width: 200px;
        object-fit: contain;
      }
      
      #logo span {
        font-size: 14px;
        font-weight: 600;
        color: var(--primary-color);
        display: none;
      }
      
      .nav__menu {
        display: flex;
        list-style: none;
        gap: 24px;
        margin: 0;
        padding: 0;
      }
      
      .nav__menu li a {
        color: var(--text-primary);
        text-decoration: none;
        font-weight: 500;
        font-size: 15px;
        transition: color 0.3s;
      }
      
      .nav__menu li a:hover {
        color: var(--primary-color);
      }
      
      .hamburger {
        display: none;
        background: none;
        border: 2px solid var(--primary-color);
        border-radius: 8px;
        padding: 8px;
        cursor: pointer;
      }
      
      .hamburger span {
        display: block;
        width: 25px;
        height: 3px;
        background: var(--primary-color);
        margin: 5px 0;
        transition: all 0.3s ease;
      }
      
      /* Legacy header for compatibility */
      .fecredit-header {
        display: none;
      }
      
      @media (min-width: 992px) {
        #logo span {
          display: inline-block;
        }
      }
      
      @media (max-width: 991px) {
        .sub-header-nav {
          flex-direction: column;
          gap: 12px;
        }

        .site-search-form {
          width: 100%;
        }

        .nav__menu {
          display: none;
          flex-direction: column;
          position: absolute;
          top: 100%;
          left: 0;
          width: 100%;
          background: var(--white-color);
          box-shadow: var(--shadow-lg);
          padding: 20px;
          gap: 16px;
        }

        .nav__menu.show {
          display: flex;
        }

        .hamburger {
          display: block;
        }
      }
      
      .header {
        background-color: var(--white-color);
        border-bottom: 1px solid var(--border-color);
        box-shadow: var(--shadow-sm);
      }
      .navbar-brand img {
        height: 32px;
      }
      .content-card {
        background-color: var(--white-color);
        padding: 1.5rem;
        border-radius: var(--border-radius-lg);
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-sm);
        margin-bottom: 1.5rem;
      }
      .card-title-group {
        display: flex;
        align-items: center;
        margin-bottom: 1.5rem;
      }
      .card-title-group .icon {
        color: var(--primary-color);
        margin-right: 1rem;
        font-size: 1.25rem;
        width: 44px;
        height: 44px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background-color: var(--light-bg);
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(0, 153, 79, 0.1);
      }
      .card-title-group .title {
        font-size: 1.25rem;
        font-weight: 700;
        margin-bottom: 0;
      }
      .info-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .info-list-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 0.5rem;
        border-bottom: 1px solid var(--border-color);
      }
      .info-list-item:last-child {
        border-bottom: none;
      }
      .info-list-item .label {
        font-size: 1rem;
        color: var(--text-secondary);
        font-weight: 500;
      }
      .info-list-item .value {
        font-size: 1rem;
        color: var(--text-primary);
        font-weight: 600;
        text-align: right;
      }
      .info-list-item .value.currency {
        font-weight: 700;
        color: var(--primary-color);
      }
      .app-container {
        padding: 1rem 1rem 100px 1rem;
        color: var(--primary-color, #00994F);
      }
      .calculation-table {
        margin-top: 15px;
        font-size: 14px;
        width: 100%;
        border-collapse: collapse;
      }
      .calculation-table th,
      .calculation-table td {
        padding: 6px;
        text-align: center;
        border: 1px solid var(--border-color);
      }
      .calculation-table th {
        background: var(--light-bg);
        font-weight: 500;
      }
      .collapsible-header {
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        background: var(--light-bg);
        border-radius: var(--border-radius-md);
        margin-top: 20px;
      }
      .collapsible-header h4 {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 600;
      }
      .collapsible-header .toggle-icon {
        transition: transform 0.3s ease;
      }
      .collapsible-header[aria-expanded="true"] .toggle-icon {
        transform: rotate(180deg);
      }
      @media (max-width: 767px) {
        /* Prevent all elements from overflowing */
        * {
          max-width: 100% !important;
        }

        img {
          max-width: 100% !important;
          height: auto !important;
        }

        .app-container {
          padding-top: 2rem;
        }
        .content-card {
          padding: 2rem;
        }
        .calculation-table {
          display: block;
          font-size: 12px;
        }
        .calculation-table thead {
          display: none;
        }
        .calculation-table tbody tr {
          display: flex;
          flex-wrap: wrap;
          padding: 8px 0;
          border-bottom: 1px solid var(--border-color);
        }
        .calculation-table tbody td {
          flex: 1 1 100%;
          padding: 4px;
          text-align: left;
          display: flex;
          justify-content: space-between;
          font-size: 11px;
        }
        .calculation-table tbody td:before {
          content: attr(data-label);
          font-weight: 500;
          color: var(--text-primary);
          display: block;
          flex: 0 0 35%;
        }
        .calculation-table tbody td:nth-child(1):before {
          content: "Tháng: ";
        }
        .calculation-table tbody td:nth-child(2):before {
          content: "Gốc: ";
        }
        .calculation-table tbody td:nth-child(3):before {
          content: "Lãi: ";
        }
        .calculation-table tbody td:nth-child(4):before {
          content: "Tổng: ";
        }
        .calculation-table tbody td:nth-child(5):before {
          content: "Dư nợ: ";
        }
      }
      #processing-overlay,
      #loading-view {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(248, 249, 250, 0.95);
        z-index: 2000;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease-in-out;
      }
      #loading-view {
        background: linear-gradient(-45deg, #E8F8EE, #f8f9fa, #D4F4E1, #f8f9fa);
        background-size: 400% 400%;
        animation: gradientBG 15s ease infinite;
      }
      @keyframes gradientBG {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      #processing-overlay.show,
      #loading-view.show {
        opacity: 1;
        visibility: visible;
      }
      #processing-overlay .spinner-border,
      #loading-view .spinner-border {
        width: 4rem;
        height: 4rem;
        border-color: rgba(0, 153, 79, 0.2);
        border-right-color: var(--primary-color);
      }
      .btn {
        transition: all 0.2s ease-in-out;
        border-radius: 12px;
        font-weight: 600;
        padding: 0.8rem 1.5rem;
        min-height: var(--touch-target);
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      .btn-primary {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        box-shadow: 0 1px 3px 0 rgba(0, 153, 79, 0.2),
          inset 0 1px 1px 0 rgb(255 255 255 / 0.2);
      }
      .btn-primary:hover {
        background-color: var(--primary-hover-color);
        border-color: var(--primary-hover-color);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 153, 79, 0.3);
      }
      .btn-primary:disabled {
        background-color: #d1d5db;
        border-color: #d1d5db;
        color: #9ca3af;
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
      }
      .form-check.is-invalid .form-check-label {
        color: var(--danger-color);
      }
      .form-check.is-invalid {
        animation: shake 0.5s;
      }
      @keyframes shake {
        10%,
        90% {
          transform: translate3d(-1px, 0, 0);
        }
        20%,
        80% {
          transform: translate3d(2px, 0, 0);
        }
        30%,
        50%,
        70% {
          transform: translate3d(-4px, 0, 0);
        }
        40%,
        60% {
          transform: translate3d(4px, 0, 0);
        }
      }

      /* Validation & Accessibility */
      .form-validation-summary {
        background: #fff3cd;
        border: 1px solid #ffc107;
        border-radius: var(--border-radius-sm);
        padding: var(--spacing-md);
        margin-bottom: var(--spacing-md);
        color: #856404;
      }

      .form-validation-summary.collapsible {
        cursor: pointer;
      }

      .form-validation-summary h4 {
        margin: 0 0 var(--spacing-sm) 0;
        font-size: 1rem;
        font-weight: 600;
      }

      .form-validation-summary ul {
        margin: 0;
        padding-left: 20px;
      }

      .invalid-feedback {
        color: var(--danger-color);
        font-size: 0.875rem;
        margin-top: 4px;
        display: none;
      }

      .invalid-feedback.show {
        display: block;
      }

      /* Screen reader only */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
      }

      /* Mobile Responsive - Fixed Sizes */
      @media (max-width: 767px) {
        /* Subheader Mobile */
        #site-subheader {
          padding: 6px 0;
        }
        
        .sub-header-nav {
          flex-direction: column;
          gap: 8px;
          padding: 0 12px;
        }
        
        .sub-header-list {
          flex-wrap: wrap;
          gap: 12px;
          font-size: 12px;
        }
        
        .sub-header-list li a {
          font-size: 12px;
          padding: 4px 0;
        }
        
        .site-search-form {
          width: 100%;
        }
        
        .site-search-form input {
          flex: 1;
          font-size: 14px;
          padding: 8px 12px;
          min-height: 36px;
        }
        
        .site-search-form button {
          min-width: 44px;
          min-height: 36px;
          padding: 8px 12px;
        }

        /* Header Mobile */
        #site-header {
          padding: 10px 0;
        }
        
        #site-header .container {
          padding: 0 12px;
        }
        
        #logo img {
          height: 32px;
          max-width: 140px;
        }
        
        .hamburger {
          display: block;
          min-width: 44px;
          min-height: 44px;
          padding: 10px;
        }
        
        .hamburger span {
          width: 22px;
          height: 2.5px;
        }

        /* Progress Stepper Mobile */
        .progress-stepper-wrapper {
          padding: 10px 0;
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }

        .progress-stepper {
          justify-content: flex-start;
          min-width: 100% !important;
          max-width: 100% !important;
          padding: 0 8px;
        }

        .stepper-step {
          min-width: 50px !important;
        }

        .stepper-line {
          min-width: 15px !important;
        }

        .stepper-label {
          font-size: 10px;
          line-height: 1.2;
        }

        .stepper-circle {
          width: 32px;
          height: 32px;
          font-size: 11px;
        }

        .stepper-line {
          min-width: 20px;
        }

        /* App Container Mobile */
        .app-container {
          padding: 12px !important;
          padding-bottom: 100px !important;
        }

        .content-card {
          padding: 16px !important;
          border-radius: 12px;
          margin-bottom: 12px;
        }

        .card-title-group {
          margin-bottom: 12px;
        }

        .card-title-group .icon {
          width: 40px !important;
          height: 40px !important;
          font-size: 1.1rem !important;
        }

        .card-title-group .title {
          font-size: 1.1rem;
        }

        .info-list-item {
          padding: 12px 8px;
          flex-direction: column;
          align-items: flex-start;
          gap: 6px;
        }

        .info-list-item .label {
          font-size: 0.875rem;
        }

        .info-list-item .value {
          font-size: 0.9rem;
          text-align: left;
        }

        .calculation-table {
          font-size: 11px;
        }

        .calculation-table th,
        .calculation-table td {
          padding: 4px;
        }

        .btn {
          min-height: 48px;
          padding: 12px 20px;
          font-size: 15px;
        }

        .btn-primary {
          width: 100%;
        }

        /* Footer Mobile */
        footer {
          padding: 20px 12px;
          font-size: 11px;
        }

        footer p {
          font-size: 11px;
          margin: 6px 0;
          line-height: 1.4;
        }

        footer img {
          height: 24px;
          margin: 4px;
        }
      }

      /* Small Mobile (max-width: 480px) */
      @media (max-width: 480px) {
        .progress-stepper {
          min-width: 100% !important;
        }

        .stepper-circle {
          width: 28px;
          height: 28px;
          font-size: 10px;
        }

        .stepper-label {
          font-size: 9px;
        }

        .content-card {
          padding: 12px !important;
        }

        .card-title-group .icon {
          width: 36px !important;
          height: 36px !important;
          font-size: 1rem !important;
        }

        .card-title-group .title {
          font-size: 1rem;
        }
      }

      @keyframes shake {
        10%,
        90% {
          transform: translate3d(-1px, 0, 0);
        }
        20%,
        80% {
          transform: translate3d(2px, 0, 0);
        }
        30%,
        50%,
        70% {
          transform: translate3d(-4px, 0, 0);
        }
        40%,
        60% {
          transform: translate3d(4px, 0, 0);
        }
      }
    </style>
  </head>
  <body>
    <!-- Site -->
    <div id="site">
        <!-- Subheader -->
        <div id="site-subheader">
            <div class="container content">
                <nav aria-label="" class="sub-header-nav secondary nav-dropdown navigation-dropdown-bg navigation-dropdown-bg-solid">
                    <ul class="sub-header-list d-flex">
                        <li>
                            <span>
                                <a href="../index.html">Về chúng tôi</a>
                            </span>
                        </li>
                        <li>
                            <span>
                                <a href="https://feonline.fecredit.com.vn/" target="_blank" rel="noreferrer noopener">Về FE ONLINE 2.0</a>
                            </span>
                        </li>
                        <li>
                            <span>
                                <a href="#site-footer">Liên hệ</a>
                            </span>
                        </li>
                    </ul>
                    <!--// Site search -->
                    <div class="form site-search-form site-search" aria-label="">
                        <form role="search" autocomplete="off" form-group="off" action="https://www.fecredit.com.vn/search/" method="get" name="searchForm">
                            <div class="form-group">
                                <input type="text" class="myInput form-control" name="search_field"
                                       aria-label="" placeholder="Bạn cần tìm gì?"
                                       value="">
                            </div>
                            <button id="search-button" type="submit" role="button"
                                    aria-label=""
                                    class="btn base-btn-bg base-btn-bg-solid base-btn-bg-hover-solid base-btn-text base-btn-borders btn-search">
                                <span></span>
                                <i aria-hidden="true" class="icon ti ti-search"></i>
                                <p>Tìm kiếm</p>
                            </button>
                        </form>
                    </div>
                </nav>
            </div>
        </div>

        <!-- Header -->
        <header id="site-header" class="header-bg header-bg-solid" tabindex="-1">
            <div class="container">
                <div class="row justify-content-between">
                    <div class="d-flex align-items-center nav-left">
                        <div id="logo">
                            <a href="../index.html" title="FE CREDIT - VAY TIÊU DÙNG TÍN CHẤP" class="w-100">
                                <img src="https://www-cdn.fecredit.com.vn/media/20ymppzv/fec-logo.svg" alt="FE CREDIT Logo"
                                     style="object-fit: contain;width:100%">
                                <span>FE CREDIT - VAY TIÊU DÙNG TÍN CHẤP</span>
                            </a>
                        </div>
                        <!-- Main navigation -->
                        <nav aria-label="" id="nav-menu"
                             class="main nav__menu nav-dropdown align-items-center navigation-dropdown-bg navigation-dropdown-bg-solid">
                            <ul class="nav__list">
                                <li class="no-child">
                                    <span>
                                        <a class="nav__link d-flex align-items-center justify-content-start text-nowrap" href="../index.html">Trang Chủ</a>
                                    </span>
                                </li>
                                <li class="no-child">
                                    <span>
                                        <a class="nav__link d-flex align-items-center justify-content-start text-nowrap" href="loan_registration.html">Đăng Ký Vay</a>
                                    </span>
                                </li>
                                <li class="no-child">
                                    <span>
                                        <a class="nav__link d-flex align-items-center justify-content-start text-nowrap" href="#site-footer">Liên Hệ</a>
                                    </span>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </header>

        <!-- Content -->
        <main id="site-content" tabindex="-1">
    <!-- Progress Stepper -->
    <div class="progress-stepper-wrapper">
      <div class="progress-stepper">
        <div class="stepper-step completed">
          <div class="stepper-circle">1</div>
          <div class="stepper-label">Thông tin</div>
        </div>
        <div class="stepper-line completed"></div>
        <div class="stepper-step completed">
          <div class="stepper-circle">2</div>
          <div class="stepper-label">eKYC</div>
        </div>
        <div class="stepper-line completed"></div>
        <div class="stepper-step completed">
          <div class="stepper-circle">3</div>
          <div class="stepper-label">Chụp ảnh</div>
        </div>
        <div class="stepper-line completed"></div>
        <div class="stepper-step completed">
          <div class="stepper-circle">4</div>
          <div class="stepper-label">Xét duyệt</div>
        </div>
        <div class="stepper-line active"></div>
        <div class="stepper-step active">
          <div class="stepper-circle">5</div>
          <div class="stepper-label">Xác nhận</div>
        </div>
        <div class="stepper-line"></div>
        <div class="stepper-step">
          <div class="stepper-circle">6</div>
          <div class="stepper-label">Giải ngân</div>
        </div>
      </div>
    </div>

    <div class="app-container container">
      <!-- Aria live region for announcements -->
      <div class="sr-only" aria-live="polite" aria-atomic="true" id="announcements"></div>
      
      <div class="row justify-content-center">
        <div class="col-lg-8" id="main-content" style="display: none">
          <div class="content-card">
            <div class="card-title-group">
              <div class="icon"><i class="fas fa-file-invoice-dollar"></i></div>
              <h3 class="title">Chi tiết Khoản vay</h3>
            </div>
            <ul class="info-list" id="loan-details-list"></ul>
            <div
              class="collapsible-header"
              data-bs-toggle="collapse"
              data-bs-target="#calculation-collapse"
              aria-expanded="false"
            >
              <h4>Bảng tính toán chi tiết</h4>
              <i class="fas fa-chevron-down toggle-icon"></i>
            </div>
            <div class="collapse" id="calculation-collapse">
              <table class="calculation-table">
                <thead>
                  <tr>
                    <th data-label="Tháng">Tháng</th>
                    <th data-label="Gốc">Gốc (đồng)</th>
                    <th data-label="Lãi">Lãi (đồng)</th>
                    <th data-label="Tổng">Tổng (đồng)</th>
                    <th data-label="Dư nợ">Dư nợ (đồng)</th>
                  </tr>
                </thead>
                <tbody id="calculation-table"></tbody>
              </table>
            </div>
          </div>

          <div class="content-card">
            <div class="card-title-group">
              <div class="icon"><i class="fas fa-check-to-slot"></i></div>
              <h3 class="title">Xác nhận & Điều khoản</h3>
            </div>
            <div class="form-check p-3">
              <input
                class="form-check-input"
                type="checkbox"
                id="contract-consent"
              />
              <label class="form-check-label" for="contract-consent"
                >Tôi xác nhận các thông tin trên là chính xác và đồng ý với
                <a
                  href="dieu-khoan-su-dung.html"
                  class="fw-bold text-decoration-none"
                  style="color: var(--primary-color)"
                  >điều khoản và điều kiện</a
                >.</label
              >
            </div>
          </div>

          <button
            id="sign-btn"
            class="btn btn-primary btn-lg w-100 position-relative"
          >
            <span class="btn-text">Xác nhận & Giải ngân</span>
          </button>
        </div>

        <div
          id="global-error"
          class="alert alert-danger"
          style="display: none"
        ></div>
      </div>
    </div>

    <div id="loading-view">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Đang tải...</span>
      </div>
      <h4 class="mt-4 fw-bold">Đang tải hợp đồng của bạn</h4>
      <p class="text-secondary mt-2 fs-5">Vui lòng chờ trong giây lát...</p>
    </div>

    <div id="processing-overlay">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <h4 class="mt-4 fw-bold">Đang xử lý khoản vay</h4>
      <p class="text-secondary mt-2 fs-5">
        Vui lòng chờ trong giây lát và không đóng trình duyệt.
      </p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import {
        getAuth,
        signInAnonymously,
        signInWithCustomToken,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      import {
        getFirestore,
        doc,
        getDoc,
        setDoc,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

      const firebaseConfigString =
        typeof __firebase_config !== "undefined" ? __firebase_config : null;
      let isDemoMode = true;
      let firebaseConfig = null;
      if (
        firebaseConfigString &&
        firebaseConfigString.trim() !== "" &&
        !firebaseConfigString.includes("DEMO_KEY") &&
        !firebaseConfigString.includes("YOUR_FIREBASE_CONFIG")
      ) {
        try {
          const parsedConfig = JSON.parse(firebaseConfigString);
          if (
            parsedConfig.apiKey &&
            parsedConfig.authDomain &&
            parsedConfig.projectId
          ) {
            firebaseConfig = parsedConfig;
            isDemoMode = false;
          }
        } catch (e) {
          if (window.Logger) {
            window.Logger.error("Lỗi phân tích cú pháp cấu hình Firebase:", e);
          }
          isDemoMode = true;
        }
      }

      const appId =
        typeof __app_id !== "undefined" ? __app_id : "default-loan-app";

      const ui = {
        mainContent: document.getElementById("main-content"),
        loadingView: document.getElementById("loading-view"),
        loanDetailsList: document.getElementById("loan-details-list"),
        consentCheck: document.getElementById("contract-consent"),
        signBtn: document.getElementById("sign-btn"),
        globalError: document.getElementById("global-error"),
        processingOverlay: document.getElementById("processing-overlay"),
        calculationTable: document.getElementById("calculation-table"),
      };

      async function main() {
        ui.loadingView.classList.add("show");
        try {
          let loanData = await loadLoanData();
          populateUI(loanData);
          setupEventListeners();
          ui.loadingView.classList.remove("show");
          ui.mainContent.style.display = "block";
        } catch (error) {
          if (window.Logger) {
            window.Logger.error("Lỗi khởi động ứng dụng:", error);
          }
          displayGlobalError(
            "Không thể tải dữ liệu khoản vay. Vui lòng quay lại <a href='step1.html'>Bước 1</a> để nhập thông tin."
          );
        }
      }

      function calculateLoanDetails(loanAmount, loanTerm, interestRate) {
        if (
          !loanAmount ||
          !loanTerm ||
          !interestRate ||
          loanAmount <= 0 ||
          loanTerm <= 0 ||
          interestRate <= 0
        ) {
          if (window.Logger) {
            window.Logger.warn("Dữ liệu không đủ để tính toán:", {
              loanAmount,
              loanTerm,
            interestRate,
          });
          return {
            monthlyPayment: 0,
            totalInterest: 0,
            totalRepay: 0,
            tableData: [],
          };
        }

        const monthlyRate = interestRate / 100 / 12;
        const monthlyPayment =
          (loanAmount * monthlyRate * Math.pow(1 + monthlyRate, loanTerm)) /
          (Math.pow(1 + monthlyRate, loanTerm) - 1);
        const totalRepay = monthlyPayment * loanTerm;
        const totalInterest = totalRepay - loanAmount;

        let balance = loanAmount;
        const tableData = [];
        for (let month = 1; month <= loanTerm; month++) {
          const interest = balance * monthlyRate;
          const principal = monthlyPayment - interest;
          balance -= principal;
          tableData.push({
            month,
            principal: Math.floor(principal),
            interest: Math.floor(interest),
            total: Math.floor(monthlyPayment),
            balance: Math.max(0, Math.floor(balance)),
          });
        }

        return {
          monthlyPayment: isNaN(monthlyPayment)
            ? 0
            : Math.floor(monthlyPayment),
          totalInterest: isNaN(totalInterest) ? 0 : Math.floor(totalInterest),
          totalRepay: isNaN(totalRepay) ? 0 : Math.floor(totalRepay),
          tableData,
        };
      }

      function loadFromLocalStorage() {
        try {
          const storedData = localStorage.getItem("userData");
          if (!storedData) {
            if (window.Logger) {
              window.Logger.warn("Không tìm thấy dữ liệu trong localStorage.");
            }
            return {
              fullName: "Chưa cung cấp",
              loanAmount: 0,
              loanTerm: 0,
              interestRate: 0,
              disbursementDate: "Chưa cung cấp",
              monthlyPayment: 0,
              totalInterest: 0,
              totalRepay: 0,
            };
          }

          let userData;
          try {
            const decryptedData = CryptoJS.AES.decrypt(
              storedData,
              "fecredit-secret-key"
            ).toString(CryptoJS.enc.Utf8);
            userData = JSON.parse(decryptedData);
          } catch (e) {
            if (window.Logger) {
              window.Logger.error("Lỗi giải mã dữ liệu từ localStorage:", e);
            }
            return {
              fullName: "Chưa cung cấp",
              loanAmount: 0,
              loanTerm: 0,
              interestRate: 0,
              disbursementDate: "Chưa cung cấp",
              monthlyPayment: 0,
              totalInterest: 0,
              totalRepay: 0,
            };
          }
          if (window.Logger) {
            window.Logger.debug("Dữ liệu từ localStorage:", userData);
          }

          let loanAmount = 0;
          if (userData.loanAmount === "other" && userData.customLoanAmount) {
            loanAmount =
              parseFloat(userData.customLoanAmount.replace(/,/g, "")) || 0;
          } else {
            loanAmount = parseFloat(userData.loanAmount.replace(/,/g, "")) || 0;
          }

          let loanData = {
            fullName:
              typeof userData.fullName === "string" && userData.fullName.trim()
                ? userData.fullName
                : "Chưa cung cấp",
            loanAmount: loanAmount,
            loanTerm: parseInt(userData.loanTerm) || 0,
            interestRate: parseFloat(userData.interestRate) || 0,
            disbursementDate:
              userData.disbursementDate &&
              /^\d{4}-\d{2}-\d{2}$/.test(userData.disbursementDate)
                ? userData.disbursementDate
                : "Chưa cung cấp",
            monthlyPayment: parseFloat(userData.monthlyPayment) || 0,
            totalInterest: parseFloat(userData.totalInterest) || 0,
            totalRepay: parseFloat(userData.totalRepay) || 0,
          };

          const paymentFields = [
            "monthlyPayment",
            "totalInterest",
            "totalRepay",
          ];
          const arePaymentsInvalid = paymentFields.some(
            (field) => isNaN(loanData[field]) || loanData[field] <= 0
          );
          if (
            arePaymentsInvalid &&
            loanData.loanAmount > 0 &&
            loanData.loanTerm > 0 &&
            loanData.interestRate > 0
          ) {
            if (window.Logger) {
              window.Logger.debug("Tính toán lại các trường thanh toán:", paymentFields);
            }
            const calculated = calculateLoanDetails(
              loanData.loanAmount,
              loanData.loanTerm,
              loanData.interestRate
            );
            loanData.monthlyPayment = calculated.monthlyPayment;
            loanData.totalInterest = calculated.totalInterest;
            loanData.totalRepay = calculated.totalRepay;
            loanData.tableData = calculated.tableData;
          } else {
            loanData.tableData = calculateLoanDetails(
              loanData.loanAmount,
              loanData.loanTerm,
              loanData.interestRate
            ).tableData;
          }

          const numericFields = [
            "loanAmount",
            "loanTerm",
            "interestRate",
            "monthlyPayment",
            "totalInterest",
            "totalRepay",
          ];
          numericFields.forEach((field) => {
            if (isNaN(loanData[field]) || loanData[field] <= 0) {
              if (window.Logger) {
                window.Logger.warn(
                  `Giá trị không hợp lệ cho ${field}: ${loanData[field]}`
                );
              }
            }
          });

          if (window.Logger) {
            window.Logger.debug("Dữ liệu đã xử lý từ localStorage:", loanData);
          }
          return loanData;
        } catch (error) {
          if (window.Logger) {
            window.Logger.error("Lỗi đọc dữ liệu từ localStorage:", error);
          }
          return {
            fullName: "Chưa cung cấp",
            loanAmount: 0,
            loanTerm: 0,
            interestRate: 0,
            disbursementDate: "Chưa cung cấp",
            monthlyPayment: 0,
            totalInterest: 0,
            totalRepay: 0,
            tableData: [],
          };
        }
      }

      async function loadLoanData() {
        const localData = loadFromLocalStorage();
        const criticalFields = ["loanAmount", "loanTerm"];
        const invalidFields = criticalFields.filter(
          (field) => isNaN(localData[field]) || localData[field] <= 0
        );
        if (invalidFields.length > 0) {
          if (window.Logger) {
            window.Logger.warn("Dữ liệu khoản vay không đầy đủ:", invalidFields);
          }
          displayGlobalError(
            "Dữ liệu khoản vay không đầy đủ. Vui lòng quay lại <a href='step1.html'>Bước 1</a> để nhập lại thông tin."
          );
        }
        return localData;
      }

      async function initFirebase() {
        if (isDemoMode) {
          if (window.Logger) {
            window.Logger.warn("Chế độ Demo: Bỏ qua kết nối Firebase.");
          }
          userId = "demo-user-123";
          return;
        }

        try {
          const app = initializeApp(firebaseConfig);
          db = getFirestore(app);
          auth = getAuth(app);

          await new Promise((resolve, reject) => {
            const unsubscribe = onAuthStateChanged(
              auth,
              async (user) => {
                unsubscribe();
                if (user) {
                  userId = user.uid;
                  return resolve();
                }
                const token =
                  typeof __initial_auth_token !== "undefined"
                    ? __initial_auth_token
                    : null;
                if (token) {
                  try {
                    await signInWithCustomToken(auth, token);
                    userId = auth.currentUser.uid;
                    resolve();
                  } catch (e) {
                    reject(new Error("Token xác thực không hợp lệ."));
                  }
                } else {
                  await signInAnonymously(auth);
                  userId = auth.currentUser.uid;
                  resolve();
                }
              },
              reject
            );
          });
        } catch (error) {
          if (window.Logger) {
            window.Logger.error("Lỗi khởi tạo Firebase:", error);
          }
          throw new Error("Không thể kết nối đến dịch vụ xác thực.");
        }
      }

      function formatCurrency(num) {
        if (typeof num !== "number" || isNaN(num) || num <= 0) return "0 VNĐ";
        return num.toLocaleString("vi-VN") + " VNĐ";
      }

      function populateUI(data) {
        const details = [
          { label: "Họ và Tên", value: data.fullName },
          {
            label: "Số tiền vay",
            value: formatCurrency(data.loanAmount),
            isCurrency: true,
          },
          {
            label: "Thời hạn vay",
            value:
              data.loanTerm > 0 ? `${data.loanTerm} tháng` : "Chưa cung cấp",
          },
          {
            label: "Lãi suất",
            value:
              data.interestRate > 0
                ? `${data.interestRate}%/năm`
                : "Chưa cung cấp",
          },
          { label: "Ngày giải ngân dự kiến", value: data.disbursementDate },
          {
            label: "Trả góp hàng tháng",
            value: formatCurrency(data.monthlyPayment),
            isCurrency: true,
          },
          {
            label: "Tổng lãi phải trả",
            value: formatCurrency(data.totalInterest),
            isCurrency: true,
          },
          {
            label: "Tổng số tiền phải trả",
            value: formatCurrency(data.totalRepay),
            isCurrency: true,
          },
        ];

        const fragment = document.createDocumentFragment();
        details.forEach((d) => {
          const li = document.createElement("li");
          li.className = "info-list-item";
          const valueClass = d.isCurrency ? "value currency" : "value";
          
          const labelSpan = document.createElement("span");
          labelSpan.className = "label";
          labelSpan.textContent = (d.label || '').replace(/[<>]/g, ""); // Sanitize label
          
          const valueSpan = document.createElement("span");
          valueSpan.className = valueClass;
          valueSpan.textContent = (d.value || '').replace(/[<>]/g, ""); // Sanitize value
          
          li.appendChild(labelSpan);
          li.appendChild(valueSpan);
          fragment.appendChild(li);
        });
        if (ui.loanDetailsList) {
          ui.loanDetailsList.innerHTML = "";
          ui.loanDetailsList.appendChild(fragment);
        }

        const tableFragment = document.createDocumentFragment();
        if (data.tableData && data.tableData.length > 0) {
          data.tableData.forEach((row) => {
            const tr = document.createElement("tr");
            const cells = [
              { label: 'Tháng', value: row.month },
              { label: 'Gốc', value: formatCurrency(row.principal) },
              { label: 'Lãi', value: formatCurrency(row.interest) },
              { label: 'Tổng', value: formatCurrency(row.total) },
              { label: 'Dư nợ', value: formatCurrency(row.balance) }
            ];
            cells.forEach(cellData => {
              const td = document.createElement('td');
              td.setAttribute('data-label', cellData.label);
              td.textContent = cellData.value;
              tr.appendChild(td);
            });
            tableFragment.appendChild(tr);
          });
        } else {
          const tr = document.createElement("tr");
          const td = document.createElement('td');
          td.setAttribute('colspan', '5');
          td.textContent = 'Không có dữ liệu để hiển thị bảng tính toán.';
          tr.appendChild(td);
          tableFragment.appendChild(tr);
        }
        ui.calculationTable.innerHTML = "";
        ui.calculationTable.appendChild(tableFragment);
      }

      function setupEventListeners() {
        ui.signBtn.addEventListener("click", processLoanConfirmation);
      }

      async function processLoanConfirmation() {
        const consentCheckContainer = ui.consentCheck.closest(".form-check");
        consentCheckContainer.classList.remove("is-invalid");

        if (!ui.consentCheck.checked) {
          consentCheckContainer.classList.add("is-invalid");
          
          // Announce error to screen readers
          const announcements = document.getElementById("announcements");
          if (announcements) {
            announcements.textContent = "Vui lòng đồng ý với điều khoản và điều kiện để tiếp tục";
          }
          
          // Focus management - focus the checkbox
          ui.consentCheck.focus();
          
          if (navigator.vibrate) navigator.vibrate(100);
          const timeout = setTimeout(() => {
            consentCheckContainer.classList.remove("is-invalid");
          }, 500);
          // Track timeout if needed (short timeout, will auto-clear)
          return;
        }

        ui.processingOverlay.classList.add("show");

        try {
          await new Promise((resolve) => {
            const timeout = setTimeout(resolve, 3000);
            // Timeout will auto-clear when resolved, no need to track
          });
          window.location.href = "step6.html";
        } catch (error) {
          if (window.Logger) {
            window.Logger.error("Lỗi xác nhận khoản vay:", error);
          }
          ui.processingOverlay.classList.remove("show");
          displayGlobalError("Xác nhận thất bại. Vui lòng thử lại sau.");
        }
      }

      function displayGlobalError(message) {
        ui.loadingView.classList.remove("show");
        ui.mainContent.style.display = "none";
        const errorDiv = document.getElementById("global-error");
        if (errorDiv) {
          errorDiv.innerHTML = '';
          // Sanitize message but allow safe HTML like <a> tags
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = message.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, ''); // Remove script tags
          while (tempDiv.firstChild) {
            errorDiv.appendChild(tempDiv.firstChild);
          }
        }
        errorDiv.style.display = "block";
      }

      document.addEventListener("DOMContentLoaded", main);

      // toggleMenu moved to shared-components.js
    </script>

        <!-- Footer -->
        <footer id="site-footer" class="footer-bg footer-bg-solid bg-gray-1" tabindex="-1" style="padding-bottom:0px !important">
            <div class="container">
                <div class="listing">
                    <div class="item footer-item usn_pod_footeritem col-lg-0 col-md-0 col-12 col">
                        <div class="inner">
                            <div id="footer-item-above" class="d-flex flex-column align-stretch align-items-start gap24 xl:flex-row">
                                <div class="footer-text d-flex flex-column align-stretch gap32">
                                    <div class="image">
                                        <img class="lazyload" loading="lazy" src="https://www-cdn.fecredit.com.vn/media/20ymppzv/fec-logo.svg" alt="logo" />
                                    </div>
                                    <h2 class="heading footer-heading">Hiện thực hóa<div class="break"></div>hàng triệu ước mơ</h2>
                                </div>
                                <div class="footer-contact d-flex flex-column justify-content-center align-items-start align-stretch p24 gap24 radius24 bg-white">
                                    <div class="contact-phone d-flex flex-column align-stretch xl:flex-row gap24">
                                        <div class="new-customer flex-center flex-column align-stretch">
                                            <p class="contact-title"><i class="ti ti-phone-call contact-icon"></i>Dành cho khách hàng mới</p>
                                            <a class="phone-link flex-center flex-column fw-700 lh150 radius16 text-uppercase c8-bg c8-bg-solid" href="tel:028 3551 6868">
                                                <span class="c8-secondary-heading">Hỗ trợ vay nhanh</span>
                                                <h5 class="heading c8-heading">028 3551 6868</h5>
                                            </a>
                                        </div>
                                        <div class="phone-divider align-stretch bg-gray-2"></div>
                                        <div class="old-customer gap16 flex-center flex-column align-stretch">
                                            <p class="contact-title"><i class="ti ti-headphones contact-icon"></i> Dành cho khách hàng hiện hữu</p>
                                            <div class="list-phone flex-center align-stretch radius16 c9-bg c9-bg-solid">
                                                <a class="phone-link align-stretch flex-center flex-column fw-700 lh150 text-uppercase" href="tel:1900 6535">
                                                    <span class="c9-secondary-heading">Khách hàng vay</span>
                                                    <h5 class="heading c9-heading">1900 6535</h5>
                                                </a>
                                                <div class="old-customer-divider"></div>
                                                <a class="phone-link align-stretch flex-center flex-column fw-700 lh150 text-uppercase" href="tel:1900 6939">
                                                    <span class="c9-secondary-heading mobile">KH thẻ tín dụng</span>
                                                    <span class="c9-secondary-heading desktop">Khách hàng thẻ tín dụng</span>
                                                    <h5 class="heading c9-heading">1900 6939</h5>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="divider-contact"></div>
                                    <div class="other-contact flex-center gap32">
                                        <div class="social d-flex flex-column justify-content-center align-items-start">
                                            <p class="contact-title">
                                                <i class="ti ti-share contact-icon"></i> Kết nối với FE CREDIT nhiều hơn
                                            </p>
                                            <div class="social-list d-flex align-items-center">
                                                <a href="https://www.facebook.com/FECREDIT.VN/" target="_blank" class="social-item flex-center radius1000 overflow-hidden flex-shrink-0">
                                                    <img loading="lazy" src="https://www-cdn.fecredit.com.vn/media/20qdzdk0/fb44.svg" alt="social-icon" class="lazyload" />
                                                </a>
                                                <a href="https://www.instagram.com/fecredit_official/" target="_blank" class="social-item flex-center radius1000 overflow-hidden flex-shrink-0">
                                                    <img loading="lazy" src="https://www-cdn.fecredit.com.vn/media/rfybl10x/it44.svg" alt="social-icon" class="lazyload" />
                                                </a>
                                                <a href="https://www.linkedin.com/company/fe-credit/" target="_blank" class="social-item flex-center radius1000 overflow-hidden flex-shrink-0">
                                                    <img loading="lazy" src="https://www-cdn.fecredit.com.vn/media/wwfcyngn/lb44.svg" alt="social-icon" class="lazyload" />
                                                </a>
                                                <a href="https://www.youtube.com/channel/UCVEbuhfBLKok_Jpl4VZVV1A/about" target="_blank" class="social-item flex-center radius1000 overflow-hidden flex-shrink-0">
                                                    <img loading="lazy" src="https://www-cdn.fecredit.com.vn/media/104pogye/yb44.svg" alt="social-icon" class="lazyload" />
                                                </a>
                                                <a href="https://www.tiktok.com/@fecredit_official" target="_blank" class="social-item flex-center radius1000 overflow-hidden flex-shrink-0">
                                                    <img loading="lazy" src="https://www-cdn.fecredit.com.vn/media/v15j2slx/tt44.svg" alt="social-icon" class="lazyload" />
                                                </a>
                                                <a href="https://zalo.me/FECREDIT" target="_blank" class="social-item flex-center radius1000 overflow-hidden flex-shrink-0">
                                                    <img loading="lazy" src="https://www-cdn.fecredit.com.vn/media/wzrnvejd/zl44.svg" alt="social-icon" class="lazyload" />
                                                </a>
                                            </div>
                                        </div>
                                        <div class="address flex-center flex-column align-stretch">
                                            <p class="contact-title"><i class="ti ti-map-pin contact-icon"></i>Địa chỉ</p>
                                            <div class="address-content align-stretch flex-column d-flex gap-0">
                                                <p class="address-title text-gray-8 fw-700 text-uppercase lh150">Phòng Dịch Vụ Khách Hàng</p>
                                                <div class="address-text text-gray-6 lh150 ls28">
                                                    <p class="addressFooter">144 Cộng Hòa, Phường Bảy Hiền, Thành phố Hồ Chí Minh.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>
  </body>
</html>
